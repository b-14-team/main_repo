<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"
            integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paginationjs/2.1.4/pagination.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/paginationjs/2.1.4/pagination.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js"></script>
    <script src="/js/board.js" defer></script>
    <link rel="stylesheet" href="/css/style.css">
    <title>WORK FLOW</title>
</head>
<body>
<div class="header">
    <div>WORK FLOW 프로젝트</div>
    <div class="buttons">
        <button class="add-button" onclick="addColumn()">칼럼 추가하기</button>
        <button class="collab-button">협업 추가하기</button>
    </div>
</div>
<div class="board" id="board">
    <!-- 칼럼이 동적으로 추가될 위치 -->
</div>

<div class="modal" id="modal">
    <div class="modal-content">
        <div class="modal-header">할 일 추가</div>
        <div class="modal-body">
            <label for="taskTitle">제목 *</label>
            <input type="text" id="taskTitle" required>
            <label for="taskStatus">카드 상태</label>
            <select id="taskStatus">
                <option value="1">시작전</option>
                <option value="2">진행중</option>
                <option value="3">완료</option>
                <option value="긴급">긴급</option>
            </select>
            <label for="taskContent">내용</label>
            <textarea id="taskContent"></textarea>
            <label for="taskDueDate">마감일자</label>
            <input type="date" id="taskDueDate">
            <label for="taskAssignee">작업자</label>
            <select id="taskAssignee">
                <!-- 옵션이 동적으로 추가될 예정 -->
            </select>
        </div>
        <div class="modal-footer">
            <button class="cancel-button" onclick="closeModal()">취소</button>
            <button class="confirm-button" onclick="addTask()">확인</button>
        </div>
    </div>
</div>

<script>
    var columnIdForFind;

    // 모달 열기
    function showModal(columnId) {
        document.getElementById('modal').style.display = 'flex';
        columnIdForFind = columnId;
    }

    // 모달 닫기
    function closeModal() {
        document.getElementById('modal').style.display = 'none';
    }

    // 할 일 추가
    function addTask() {
        var title = document.getElementById('taskTitle').value;
        var status = document.getElementById('taskStatus').value;
        var content = document.getElementById('taskContent').value;
        var dueDate = document.getElementById('taskDueDate').value;
        var assignee = document.getElementById('taskAssignee').value;

        if (!title) {
            alert("제목은 필수 항목입니다.");
            return;
        }

        // task 객체 생성
        var task = {
            title: title,
            content: content,
            deadDate: dueDate ? new Date(dueDate).toISOString() : null,
            assigneeId: assignee ? parseInt(assignee) : null,
            status: status
        };

        // cardDto 객체 생성
        var cardDto = {
            title: title,
            content: content,
            deadDate: dueDate ? new Date(dueDate).toISOString() : null,
            assigneeId: assignee ? parseInt(assignee) : null,
            status: status,
            tasks: [task]
        };

        addCard(cardDto,columnIdForFind);
        closeModal();
    }

</script>

</body>
</html>
